<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–°–ê–í–† Tools</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://unpkg.com/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <style>
        :root {
            --bg: #f0f2f5;
            --card: #ffffff;
            --text: #2d3436;
            --primary: #0984e3;
            --border: #dfe6e9;
            --input-bg: #f8f9fa;
        }

        body.dark-mode {
            --bg: #121212;
            --card: #1e1e1e;
            --text: #dfe6e9;
            --primary: #48dbfb;
            --border: #333;
            --input-bg: #2d2d2d;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, Roboto, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 10px;
        }

        .wrapper {
            max-width: 1000px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* --- –®–ê–ü–ö–ê --- */
        .header {
            display: flex; justify-content: space-between; align-items: center;
            background: var(--card); padding: 15px; border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .logo { font-size: 1.4rem; font-weight: 900; }
        .theme-btn { background: none; border: none; font-size: 1.5rem; cursor: pointer; }

        /* --- –ì–õ–ê–í–ù–ê–Ø –°–ï–¢–ö–ê (FLEXBOX) --- */
        .grid-row {
            display: flex;
            flex-wrap: wrap; /* –†–∞–∑—Ä–µ—à–∞–µ–º –ø–µ—Ä–µ–Ω–æ—Å –Ω–∞ –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É */
            gap: 15px;
        }

        .card {
            background: var(--card);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            /* –ê–î–ê–ü–¢–ê–¶–ò–Ø –ó–î–ï–°–¨: */
            flex: 1 1 340px; /* –ë–∞–∑–æ–≤–∞—è —à–∏—Ä–∏–Ω–∞ 340px. –ï—Å–ª–∏ —ç–∫—Ä–∞–Ω –º–µ–Ω—å—à–µ - —Ä–∞—Å—Ç—è–Ω–µ—Ç—Å—è –Ω–∞ 100% */
            min-width: 0; /* –ß—Ç–æ–±—ã –Ω–µ –≤—ã–ª–µ–∑–∞–ª–æ –∑–∞ –ø—Ä–µ–¥–µ–ª—ã flex-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
        }

        .full-width { flex: 1 1 100%; }

        h2 { margin: 0 0 15px 0; color: var(--primary); text-align: center; text-transform: uppercase; font-size: 1.1rem; }

        /* --- –≠–õ–ï–ú–ï–ù–¢–´ –£–ü–†–ê–í–õ–ï–ù–ò–Ø --- */
        .inp-row { display: flex; gap: 10px; margin-bottom: 12px; }
        .inp-box { flex: 1; }
        label { display: block; font-size: 0.8rem; font-weight: bold; margin-bottom: 5px; opacity: 0.7; }
        
        input {
            width: 100%; padding: 12px; 
            border: 2px solid var(--border); border-radius: 10px;
            background: var(--input-bg); color: var(--text);
            font-size: 16px; /* –ó–∞—â–∏—Ç–∞ –æ—Ç –∑—É–º–∞ –Ω–∞ iPhone */
            font-weight: bold;
        }
        input:focus { outline: none; border-color: var(--primary); }

        .btn {
            width: 100%; padding: 15px; border: none; border-radius: 10px;
            background: var(--primary); color: white;
            font-weight: 900; font-size: 1rem; text-transform: uppercase;
            cursor: pointer;
        }
        .btn:active { transform: scale(0.98); opacity: 0.9; }

        /* --- –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–† --- */
        #display {
            width: 100%; height: 70px; background: #222; color: #00cec9;
            text-align: right; padding: 15px; font-size: 2.5rem; font-weight: bold;
            border-radius: 10px; margin-bottom: 10px; overflow: hidden;
            display: flex; align-items: center; justify-content: flex-end;
            border: 2px solid var(--primary);
        }
        .calc-keys { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
        .k {
            height: 60px; border: none; border-radius: 10px;
            font-size: 1.5rem; font-weight: bold;
            background: var(--input-bg); color: var(--text);
            box-shadow: 0 2px 0 rgba(0,0,0,0.1); cursor: pointer;
        }
        .k:active { transform: translateY(2px); box-shadow: none; }
        .k-red { background: #ff7675; color: white; }
        .k-blue { background: #74b9ff; color: white; }
        .k-org { background: #ffeaa7; color: #d35400; }
        .k-grn { background: #00b894; color: white; grid-row: span 2; height: 100%; }
        .span2 { grid-column: span 2; }

        /* --- –í–´–ë–û–† –†–ï–ñ–ò–ú–ê --- */
        .toggle-box { display: flex; gap: 5px; margin-bottom: 15px; background: var(--input-bg); padding: 5px; border-radius: 10px; }
        .t-btn { flex: 1; padding: 10px; border: none; border-radius: 8px; font-weight: bold; background: transparent; color: var(--text); }
        .t-btn.active { background: var(--card); color: var(--primary); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

        /* --- –†–ê–°–ö–†–û–ô --- */
        .edge-box { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; margin-bottom: 15px; }
        .e-btn { padding: 10px; border: 1px solid var(--border); border-radius: 8px; background: var(--input-bg); font-weight: bold; color: var(--text); }
        .e-btn.active { background: #ff7675; color: white; border-color: #ff7675; }

        #cutCanvas { width: 100%; background: white; border-radius: 10px; margin-top: 15px; border: 1px dashed var(--border); }
        .part-row { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid var(--border); font-size: 0.9rem; }
        .del { color: #ff7675; font-weight: bold; padding: 5px; }

        /* --- 3D --- */
        #c3d {
            width: 100%; height: 350px; background: #333;
            border-radius: 15px; margin-top: 15px; position: relative;
            overflow: hidden; border: 2px solid var(--border);
        }
        .fs-icon {
            position: absolute; top: 10px; right: 10px; width: 40px; height: 40px;
            background: rgba(0,0,0,0.6); color: white; border: none; border-radius: 8px;
            font-size: 1.5rem; z-index: 99;
        }

        /* –ö–æ–Ω—Ç–µ–∫—Å—Ç –º–µ–Ω—é */
        #cm {
            position: fixed; display: none; z-index: 999;
            background: var(--card); border: 1px solid var(--border);
            border-radius: 10px; box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            min-width: 180px;
        }
        .cm-i { padding: 12px 15px; border-bottom: 1px solid var(--border); font-weight: 500; cursor: pointer; }
        .cm-i:last-child { border: none; }
        
        #resInfo { margin-top: 15px; padding: 15px; background: rgba(9,132,227,0.1); border-radius: 10px; text-align: center; display: none; }
        #fileIn { display: none; }
    </style>
</head>
<body>

<div id="cm">
    <div class="cm-i" onclick="loadTex()">üñº –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ–∫—Å—Ç—É—Ä—É</div>
    <div class="cm-i" onclick="clearTex()">üóë –£–¥–∞–ª–∏—Ç—å —Ç–µ–∫—Å—Ç—É—Ä—É</div>
</div>

<div class="wrapper">
    <div class="header">
        <div class="logo">–°–ê–í–† <span style="color:var(--primary)">Tools</span></div>
        <button class="theme-btn" onclick="toggleT()">üåì</button>
    </div>

    <div class="grid-row">
        <div class="card">
            <h2>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</h2>
            <div id="display">0</div>
            <div class="calc-keys">
                <button class="k k-red" onclick="clr()">C</button>
                <button class="k k-blue" onclick="back()">‚Üê</button>
                <button class="k k-org" onclick="add('/')">√∑</button>
                <button class="k k-org" onclick="add('*')">√ó</button>
                <button class="k" onclick="add('7')">7</button><button class="k" onclick="add('8')">8</button><button class="k" onclick="add('9')">9</button>
                <button class="k k-org" onclick="add('-')">‚àí</button>
                <button class="k" onclick="add('4')">4</button><button class="k" onclick="add('5')">5</button><button class="k" onclick="add('6')">6</button>
                <button class="k k-org" onclick="add('+')">+</button>
                <button class="k" onclick="add('1')">1</button><button class="k" onclick="add('2')">2</button><button class="k" onclick="add('3')">3</button>
                <button class="k k-grn" onclick="solve()">=</button>
                <button class="k span2" onclick="add('0')">0</button><button class="k" onclick="add('.')">.</button>
            </div>
        </div>

        <div class="card">
            <h2>–¶–µ–Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–∞</h2>
            <div class="inp-row">
                <div class="inp-box"><label>–î–ª–∏–Ω–∞</label><input type="number" id="mL" value="2.80"></div>
                <div class="inp-box"><label>–®–∏—Ä–∏–Ω–∞</label><input type="number" id="mW" value="2.07"></div>
            </div>
            <div class="toggle-box">
                <button class="t-btn active" id="btnS" onclick="setM('s')">–ó–∞ –º¬≤</button>
                <button class="t-btn" id="btnW" onclick="setM('w')">–ó–∞ –ª–∏—Å—Ç</button>
            </div>
            <div class="inp-row"><div class="inp-box"><label id="pLbl">–¶–µ–Ω–∞ –º¬≤</label><input type="number" id="mP" placeholder="0.00"></div></div>
            <div class="inp-row"><div class="inp-box"><label>–ö–æ–ª-–≤–æ –ª–∏—Å—Ç–æ–≤</label><input type="number" id="mQ" value="1"></div></div>
            <button class="btn" onclick="calcP()">–°—á–∏—Ç–∞—Ç—å</button>
            <div id="resInfo">–ò—Ç–æ–≥–æ: <b id="tot" style="font-size:1.5rem; color:var(--primary)">0</b> —Å–æ–º</div>
        </div>
    </div>

    <div class="card full-width">
        <h2>‚úÇÔ∏è –†–∞—Å–∫—Ä–æ–π</h2>
        <div class="inp-row">
            <div class="inp-box"><label>–õ–∏—Å—Ç –î–ª.</label><input type="number" id="sL" value="2800"></div>
            <div class="inp-box"><label>–õ–∏—Å—Ç –®–∏—Ä.</label><input type="number" id="sW" value="2070"></div>
            <div class="inp-box"><label>–ü–∏–ª</label><input type="number" id="kerf" value="4"></div>
        </div>
        <hr style="border:0; border-top:1px solid var(--border); margin:10px 0;">
        <div class="inp-row">
            <div class="inp-box"><label>–î–ª–∏–Ω–∞ –¥–µ—Ç.</label><input type="number" id="dL" placeholder="–º–º"></div>
            <div class="inp-box"><label>–®–∏—Ä–∏–Ω–∞ –¥–µ—Ç.</label><input type="number" id="dW" placeholder="–º–º"></div>
            <div class="inp-box" style="flex:0.5"><label>–®—Ç</label><input type="number" id="dQ" value="1"></div>
        </div>
        <label>–ö—Ä–æ–º–∫–∞:</label>
        <div class="edge-box">
            <button class="e-btn" id="eT" onclick="tE('T')">–í–µ—Ä—Ö</button>
            <button class="e-btn" id="eB" onclick="tE('B')">–ù–∏–∑</button>
            <button class="e-btn" id="eL" onclick="tE('L')">–õ–µ–≤–æ</button>
            <button class="e-btn" id="eR" onclick="tE('R')">–ü—Ä–∞–≤–æ</button>
        </div>
        <div style="margin-bottom:15px">
            <input type="checkbox" id="rot" checked> <label style="display:inline">–í—Ä–∞—â–∞—Ç—å –¥–µ—Ç–∞–ª—å</label>
        </div>
        <button class="btn" onclick="addP()">+ –î–µ—Ç–∞–ª—å</button>
        <div id="pList" style="margin:15px 0"></div>
        <button class="btn" style="background:#00b894" onclick="doCut()">–†–∞—Å–∫—Ä–æ–∏—Ç—å</button>
        <div id="cutRes" style="text-align:center; margin-top:10px; font-weight:bold;"></div>
        <div style="overflow-x: hidden;"><canvas id="cutCanvas"></canvas></div>
    </div>

    <div class="card full-width">
        <h2>üßä 3D –í–∏–¥</h2>
        <div class="inp-row">
            <div class="inp-box"><label>–î–ª–∏–Ω–∞</label><input type="number" id="3L" value="500" oninput="u3()"></div>
            <div class="inp-box"><label>–®–∏—Ä–∏–Ω–∞</label><input type="number" id="3W" value="300" oninput="u3()"></div>
            <div class="inp-box"><label>–¢–æ–ª—â</label><input type="number" id="3H" value="16" oninput="u3()"></div>
        </div>
        <p style="font-size:0.8rem; text-align:center; opacity:0.7">–ü–ö–ú –ø–æ –¥–µ—Ç–∞–ª–∏ = –ú–µ–Ω—é —Ç–µ–∫—Å—Ç—É—Ä</p>
        <input type="file" id="fileIn" accept="image/*">
        <div id="c3d"><button class="fs-icon" onclick="fs()">‚õ∂</button></div>
    </div>
</div>

<script>
// --- TEMA ---
function toggleT() { document.body.classList.toggle('dark-mode'); if(scene) scene.background = document.body.classList.contains('dark-mode')?new THREE.Color(0x222):new THREE.Color(0xccc); }

// --- CALC ---
const d=document.getElementById('display');
const add=v=>d.innerText=='0'?d.innerText=v:d.innerText+=v;
const clr=()=>d.innerText='0';
const back=()=>d.innerText=d.innerText.length>1?d.innerText.slice(0,-1):'0';
const solve=()=>{try{d.innerText=Number(eval(d.innerText.replace('‚àí','-')).toFixed(4))}catch{d.innerText='Err'}};

// --- PRICE ---
let pm='s';
const setM=m=>{pm=m; document.getElementById('btnS').classList.toggle('active',m=='s'); document.getElementById('btnW').classList.toggle('active',m=='w'); document.getElementById('pLbl').innerText=m=='s'?"–¶–µ–Ω–∞ –º¬≤":"–¶–µ–Ω–∞ –ª–∏—Å—Ç"};
function calcP(){
    let l=parseFloat(document.getElementById('mL').value)||0, w=parseFloat(document.getElementById('mW').value)||0, p=parseFloat(document.getElementById('mP').value)||0, q=parseFloat(document.getElementById('mQ').value)||1;
    document.getElementById('tot').innerText = ((pm=='s'?l*w*p*q:p*q)).toLocaleString('ru-RU',{minimumFractionDigits:2});
    document.getElementById('resInfo').style.display='block';
}

// --- CUT ---
let parts=[], ed={T:0,B:0,L:0,R:0};
function tE(s){ed[s]=!ed[s]; document.getElementById('e'+s).classList.toggle('active')}
function addP(){
    let l=parseFloat(document.getElementById('dL').value), w=parseFloat(document.getElementById('dW').value), q=parseInt(document.getElementById('dQ').value);
    if(!l||!w||!q)return;
    parts.push({l,w,q,e:{...ed},r:document.getElementById('rot').checked,id:Date.now()});
    ed={T:0,B:0,L:0,R:0}; ['T','B','L','R'].forEach(x=>document.getElementById('e'+x).classList.remove('active'));
    document.getElementById('dL').value=''; renderP();
}
function delP(id){parts=parts.filter(p=>p.id!=id); renderP();}
function renderP(){
    document.getElementById('pList').innerHTML=parts.map((p,i)=>`<div class="part-row"><span>${i+1}. ${p.l}x${p.w} (${p.q}—à—Ç)</span><span class="del" onclick="delP(${p.id})">‚úï</span></div>`).join('');
}
function doCut(){
    const cv=document.getElementById('cutCanvas'), cx=cv.getContext('2d');
    const SL=parseFloat(document.getElementById('sL').value)||2800, SW=parseFloat(document.getElementById('sW').value)||2070, K=parseFloat(document.getElementById('kerf').value)||4;
    
    // –ê–î–ê–ü–¢–ò–í–ù–ê–Ø –®–ò–†–ò–ù–ê CANVAS
    const boxW = document.querySelector('.full-width').clientWidth - 40; 
    cv.width = boxW;
    
    const sc=boxW/SL, shP=SW*sc, gap=20;
    let all=[]; parts.forEach(p=>{for(let i=0;i<p.q;i++)all.push({...p})}); all.sort((a,b)=>b.w-a.w);
    
    let plc=[], x=0, y=0, rh=0, si=0;
    all.forEach(p=>{
        let pw=p.l*sc, ph=p.w*sc, k=K*sc;
        if(x+pw>boxW){x=0; y+=rh+k; rh=0;}
        if(y+ph>shP){si++; x=0; y=0; rh=0;}
        plc.push({x,y,w:pw,h:ph,si,orig:p});
        rh=Math.max(rh,ph); x+=pw+k;
    });
    
    let sheets=si+1; cv.height=(shP+gap)*sheets; cx.fillStyle="#fff"; cx.fillRect(0,0,cv.width,cv.height);
    for(let i=0;i<sheets;i++){
        let sy=i*(shP+gap); cx.fillStyle="#eee"; cx.fillRect(0,sy,boxW,shP); cx.strokeRect(0,sy,boxW,shP);
        cx.fillStyle="#0984e3"; cx.fillText(`–õ–∏—Å—Ç ${i+1}`,5,sy+15);
    }
    plc.forEach(d=>{
        let gy=d.y+d.si*(shP+gap); cx.fillStyle="#81ecec"; cx.fillRect(d.x,gy,d.w,d.h); cx.strokeRect(d.x,gy,d.w,d.h);
        cx.beginPath(); cx.lineWidth=3; cx.strokeStyle="#ff7675";
        if(d.orig.e.T){cx.moveTo(d.x,gy);cx.lineTo(d.x+d.w,gy)}
        if(d.orig.e.B){cx.moveTo(d.x,gy+d.h);cx.lineTo(d.x+d.w,gy+d.h)}
        cx.stroke();
    });
    document.getElementById('cutRes').innerHTML=`–õ–∏—Å—Ç–æ–≤: ${sheets}`;
}

// --- 3D ---
let scene, camera, renderer, cube, selF=-1;
const cm=document.getElementById('cm');
function init3D(){
    const c=document.getElementById('c3d');
    scene=new THREE.Scene(); scene.background=new THREE.Color(0xcccccc);
    camera=new THREE.PerspectiveCamera(50, c.clientWidth/c.clientHeight, 0.1, 1000); camera.position.set(400,400,400); camera.lookAt(0,0,0);
    renderer=new THREE.WebGLRenderer({antialias:true}); renderer.setSize(c.clientWidth,c.clientHeight); c.appendChild(renderer.domElement);
    const ctr=new THREE.OrbitControls(camera, renderer.domElement); ctr.enableDamping=true;
    scene.add(new THREE.AmbientLight(0x777));
    let dl=new THREE.DirectionalLight(0xffffff,1); dl.position.set(5,10,7); scene.add(dl);
    cube=new THREE.Mesh(new THREE.BoxGeometry(1,1,1), Array(6).fill().map(()=>new THREE.MeshStandardMaterial({color:0xffffff}))); scene.add(cube);
    u3(); animate();

    const rc=new THREE.Raycaster();
    c.addEventListener('contextmenu',e=>{
        e.preventDefault();
        let r=renderer.domElement.getBoundingClientRect();
        let m={x:((e.clientX-r.left)/r.width)*2-1, y:-((e.clientY-r.top)/r.height)*2+1};
        rc.setFromCamera(m,camera); let h=rc.intersectObjects([cube]);
        if(h.length){selF=h[0].face.materialIndex; cm.style.display='block'; cm.style.left=e.clientX+'px'; cm.style.top=e.clientY+'px';}
    });
    window.addEventListener('click',()=>cm.style.display='none');
    window.addEventListener('resize', ()=>{
        camera.aspect=c.clientWidth/c.clientHeight; camera.updateProjectionMatrix(); renderer.setSize(c.clientWidth,c.clientHeight);
        if(parts.length) doCut(); // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ —Ä–∞—Å–∫—Ä–æ—è
    });
}
function u3(){ if(cube) cube.scale.set(parseFloat(document.getElementById('3L').value)||100, parseFloat(document.getElementById('3H').value)||16, parseFloat(document.getElementById('3W').value)||100); }
function loadTex(){document.getElementById('fileIn').click()}
function clearTex(){if(selF>=0){cube.material[selF].map=null;cube.material[selF].needsUpdate=true}}
document.getElementById('fileIn').addEventListener('change',e=>{
    if(e.target.files[0] && selF>=0){
        new THREE.TextureLoader().load(URL.createObjectURL(e.target.files[0]), t=>{cube.material[selF].map=t;cube.material[selF].needsUpdate=true});
    }
});
function fs(){let el=document.getElementById('c3d'); !document.fullscreenElement?el.requestFullscreen():document.exitFullscreen()}
function animate(){requestAnimationFrame(animate); renderer.render(scene,camera);}
window.addEventListener('load', init3D);

</script>
</body>
</html>